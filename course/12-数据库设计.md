# 数据库的设计与创建

## 概述

我们的项目为前后端一体化设计，未实现分离，所以没有接口。大家可以根据自己的兴趣来设计接口以实现前后端分离。

本章节的主要任务是分析需求，进行数据库表的设计。

我们的项目中的数据全部使用 MySQL 数据库存储，大家在自主增加需求时可以酝情选择其它数据库进行尝试。

根据需求分析，我们需要提供如下几张表以存储用户数据：

- 用户表：存储用户的基本信息，这里包含个人用户和企业用户；
- 公司详情表：该表用于存储用户表中企业用户的额外信息，与用户表是一对一关系；
- 简历表：用户的个人简历，此处暂设为与用户表是一对一关系，即每个个人用户有一张简历；
- 职位表：公司可以设置招聘职位，职位信息存储在该表中，每个公司可以设置多个职位，所以该表与公司是一对多关系；
- 简历投递表：个人用户对职位投递简历，每次投递操作都会记录到该表中，所以该表对职位和简历都是一对多关系。

项目涉及的数据表及其关联关系如下图所示：

<img style="border:2px solid #888; max-width:600px;" src="https://doc.shiyanlou.com/courses/8913/310176/a7021e59914a491789a2898f41fc65bc-0/wm">

**注意**数据表命名一律使用英文单数名词，理由如下：

- 概念直观：例如 user 表，user 表示“用户”，该表是用来存用户信息的，与用户数量无关；
- 写法简单：英文名词的复数规则复杂，甚至有单复同形的，采用单数更利于书写和阅读。

## 用户表 user

这是几乎所有网站的一张必备数据表，用于存储用户信息。对于蓝桥云课而言，用户就包括管理员、课程教师、来学习的学生、高校专区的管理员、专区所属教师、专区所属学生等，也就是所有「人」都是用户。对于我们的招聘网站而言亦是如此，提供工作职位的企业和应聘的个人都是用户。

我们的用户表 user 中包含如下字段：

| 字段名     | 数据类型     | 说明                   |
| ---------- | ------------ | ---------------------- |
| id         | int          | 数据表的自增主键（非空 |
| name       | varchar(64)  | 用户名（非空           |
| email      | varchar(128) | 邮箱（非空             |
| password   | varchar(256) | 哈希密码（非空         |
| role       | int          | 角色值                 |
| Is_disable | tinyint      | 是否被封禁             |
| create_at  | datetime     | 创建日期时间           |
| update_at  | datetime     | 修改日期时间           |

## 公司详情表 company_detail

该表用于保存公司的基本信息，它是企业用户在 user 表之外的一个补充，与 user 表是一对一关系。

通常大家会使用 Flask-SQLAlchemy 的 relationship 类加上一个 uselist=False 参数构建一对一关系，不过我们可以使用一种更简洁的方式，就是将公司详情表的主键与用户表的主键建立外键关联关系：

```python
id = db.Column(db.Integer, 
    db.ForeignKey('user.id', ondelete='CASCADE'),
    primary_key=True
)
```

公司详情表中字段信息如下：

| 字段名    | 数据类型     | 说明                                                         |
| --------- | ------------ | ------------------------------------------------------------ |
| id        | int          | 主键，且与 user 表的主键建立外键关联，也就是两张表的 id 等值 |
| image_url | varchar(256) | 企业 LOGO 的网址                                             |
| finance   | varchar(64)  | 企业融资情况                                                 |
| staff_num | varchar(64)  | 公司员工数量规模                                             |
| type      | varchar(64)  | 公司类型                                                     |
| about     | text         | 公司简介                                                     |
| create_at | datetime     | 创建日期时间                                                 |
| update_at | datetime     | 修改日期时间                                                 |

## 个人简历表 resume

该表用于存储用户的简历信息，可以随时修改。注意该表与 user 表也是一对一的关系

通常我们需要一个简历文件上传的功能用于将准备好的简历保存到网站中，这个文件自然是不能存储到 MySQL 数据表里，它要放到静态文件目录下，而数据库中存储该文件的静态目录。

简历表的字段信息如下：

| 字段名         | 数据类型     | 说明                                                         |
| -------------- | ------------ | ------------------------------------------------------------ |
| id             | int          | 主键，且与 user 表的主键建立外键关联，也就是两张表的 id 等值 |
| name           | varchar(32)  | 姓名                                                         |
| age            | smallint     | 年龄                                                         |
| work_age       | smallint     | 工龄                                                         |
| home_city      | varchar(64)  | 家乡                                                         |
| job_experience | text         | 工作经历                                                     |
| edu_experience | text         | 教育经历                                                     |
| pro_experience | text         | 项目经历                                                     |
| resume_url     | varchar(128) | 简历文件的静态目录                                           |
| create_at      | datetime     | 创建日期时间                                                 |
| update_at      | datetime     | 修改日期时间                                                 |

## 职位表 job

该表与用户表是一对多的关系，一个企业用户可以创建多个与之关联的职位。

同时职位表与简历投递表也有外键关联关系，但这个关系的设置不必出现在前者中。

职位表的字段信息如下：

| 字段名                 | 数据类型    | 说明                          |
| ---------------------- | ----------- | ----------------------------- |
| id                     | int         | 数据表的自增主键              |
| name                   | varchar(64) | 职位名称                      |
| salary                 | varchar(64) | 薪资范围                      |
| location               | varchar(64) | 所在城市                      |
| experience_requirement | varchar(64) | 经验要求                      |
| degree_requirement     | varchar(64) | 学历要求                      |
| is_fulltime            | tinyint(1)  | 是否全职                      |
| release_time           | varchar(64) | 职位发布时间                  |
| is_open                | tinyint(1)  | 职位是否开放                  |
| is_disable             | tinyint(1)  | 职位是否失效                  |
| user_id                | int         | 创建者 ID（外键关联至企业用户 |
| create_at              | datetime    | 创建日期时间                  |
| update_at              | datetime    | 修改日期时间                  |

## 简历投递表 delivery

这是我们设计的最后一张表，当用户执行了投递简历操作，就会在该表中增加一条数据以记录这次操作。

该表的核心字段就是两个外键：resume_id 外键关联至求职者的简历 ID；job_id 外键关联至职位的 ID。

简历投递表的字段信息如下：

| 字段名    | 数据类型     | 说明                            |
| --------- | ------------ | ------------------------------- |
| id        | int          | 数据表的自增主键                |
| resume_id | int          | 简历 ID（外键关联至简历表的主键 |
| job_id    | int          | 职位 ID（外键关联至职位表的主键 |
| status    | int          | 投递状态码                      |
| response  | varchar(256) | 企业阅读本次投递后进行的回复    |
| create_at | datetime     | 创建日期时间                    |
| update_at | datetime     | 修改日期时间                    |

## 
